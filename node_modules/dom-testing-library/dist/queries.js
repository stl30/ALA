'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getByRole = exports.getAllByRole = exports.queryAllByRole = exports.queryByRole = exports.getAllByValue = exports.getByValue = exports.queryAllByValue = exports.queryByValue = exports.getAllByTitle = exports.getByTitle = exports.queryAllByTitle = exports.queryByTitle = exports.getAllByTestId = exports.getByTestId = exports.queryAllByTestId = exports.queryByTestId = exports.getAllBySelectText = exports.getBySelectText = exports.queryAllBySelectText = exports.queryBySelectText = exports.getAllByAltText = exports.getByAltText = exports.queryAllByAltText = exports.queryByAltText = exports.getAllByLabelText = exports.getByLabelText = exports.queryAllByLabelText = exports.queryByLabelText = exports.getAllByText = exports.getByText = exports.queryAllByText = exports.queryByText = exports.getAllByPlaceholderText = exports.getByPlaceholderText = exports.queryAllByPlaceholderText = exports.queryByPlaceholderText = undefined;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _matches = require('./matches');

var _getNodeText = require('./get-node-text');

var _queryHelpers = require('./query-helpers');

// Here are the queries for the library.
// The queries here should only be things that are accessible to both users who are using a screen reader
// and those who are not using a screen reader (with the exception of the data-testid attribute query).

function queryAllLabelsByText(container, text) {
  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref$exact = _ref.exact,
      exact = _ref$exact === undefined ? true : _ref$exact,
      _ref$trim = _ref.trim,
      trim = _ref$trim === undefined ? true : _ref$trim,
      _ref$collapseWhitespa = _ref.collapseWhitespace,
      collapseWhitespace = _ref$collapseWhitespa === undefined ? true : _ref$collapseWhitespa;

  var matcher = exact ? _matches.matches : _matches.fuzzyMatches;
  var matchOpts = { collapseWhitespace, trim };
  return Array.from(container.querySelectorAll('label')).filter(function (label) {
    return matcher(label.textContent, label, text, matchOpts);
  });
}

function queryAllByLabelText(container, text) {
  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref2$selector = _ref2.selector,
      selector = _ref2$selector === undefined ? '*' : _ref2$selector,
      _ref2$exact = _ref2.exact,
      exact = _ref2$exact === undefined ? true : _ref2$exact,
      _ref2$collapseWhitesp = _ref2.collapseWhitespace,
      collapseWhitespace = _ref2$collapseWhitesp === undefined ? true : _ref2$collapseWhitesp,
      _ref2$trim = _ref2.trim,
      trim = _ref2$trim === undefined ? true : _ref2$trim;

  var matchOpts = { collapseWhitespace, trim };
  var labels = queryAllLabelsByText(container, text, _extends({ exact }, matchOpts));
  var labelledElements = labels.map(function (label) {
    if (label.control) {
      return label.control;
    }
    /* istanbul ignore if */
    if (label.getAttribute('for')) {
      // we're using this notation because with the # selector we would have to escape special characters e.g. user.name
      // see https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector#Escaping_special_characters
      // <label for="someId">text</label><input id="someId" />

      // .control support has landed in jsdom (https://github.com/jsdom/jsdom/issues/2175)
      return container.querySelector(`[id="${label.getAttribute('for')}"]`);
    }
    if (label.getAttribute('id')) {
      // <label id="someId">text</label><input aria-labelledby="someId" />
      return container.querySelector(`[aria-labelledby~="${label.getAttribute('id')}"]`);
    }
    if (label.childNodes.length) {
      // <label>text: <input /></label>
      return label.querySelector(selector);
    }
    return null;
  }).filter(function (label) {
    return label !== null;
  }).concat((0, _queryHelpers.queryAllByAttribute)('aria-label', container, text, { exact }));

  var possibleAriaLabelElements = queryAllByText(container, text, _extends({
    exact
  }, matchOpts)).filter(function (el) {
    return el.tagName !== 'LABEL';
  }); // don't reprocess labels

  var ariaLabelledElements = possibleAriaLabelElements.reduce(function (allLabelledElements, nextLabelElement) {
    var labelId = nextLabelElement.getAttribute('id');

    if (!labelId) return allLabelledElements;

    // ARIA labels can label multiple elements
    var labelledNodes = Array.from(container.querySelectorAll(`[aria-labelledby~="${labelId}"]`));

    return allLabelledElements.concat(labelledNodes);
  }, []);

  return Array.from(new Set([].concat(labelledElements, ariaLabelledElements)));
}

function queryByLabelText() {
  for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
    args[_key] = arguments[_key];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [queryAllByLabelText].concat(args));
}

function queryAllByText(container, text) {
  var _ref3 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref3$selector = _ref3.selector,
      selector = _ref3$selector === undefined ? '*' : _ref3$selector,
      _ref3$exact = _ref3.exact,
      exact = _ref3$exact === undefined ? true : _ref3$exact,
      _ref3$collapseWhitesp = _ref3.collapseWhitespace,
      collapseWhitespace = _ref3$collapseWhitesp === undefined ? true : _ref3$collapseWhitesp,
      _ref3$trim = _ref3.trim,
      trim = _ref3$trim === undefined ? true : _ref3$trim,
      _ref3$ignore = _ref3.ignore,
      ignore = _ref3$ignore === undefined ? 'script, style' : _ref3$ignore;

  var matcher = exact ? _matches.matches : _matches.fuzzyMatches;
  var matchOpts = { collapseWhitespace, trim };
  return Array.from(container.querySelectorAll(selector)).filter(function (node) {
    return !ignore || !node.matches(ignore);
  }).filter(function (node) {
    return matcher((0, _getNodeText.getNodeText)(node), node, text, matchOpts);
  });
}

function queryByText() {
  for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
    args[_key2] = arguments[_key2];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [queryAllByText].concat(args));
}

function queryAllByTitle(container, text) {
  var _ref4 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref4$exact = _ref4.exact,
      exact = _ref4$exact === undefined ? true : _ref4$exact,
      _ref4$collapseWhitesp = _ref4.collapseWhitespace,
      collapseWhitespace = _ref4$collapseWhitesp === undefined ? true : _ref4$collapseWhitesp,
      _ref4$trim = _ref4.trim,
      trim = _ref4$trim === undefined ? true : _ref4$trim;

  var matcher = exact ? _matches.matches : _matches.fuzzyMatches;
  var matchOpts = { collapseWhitespace, trim };
  return Array.from(container.querySelectorAll('[title], svg > title')).filter(function (node) {
    return matcher(node.getAttribute('title'), node, text, matchOpts) || matcher((0, _getNodeText.getNodeText)(node), node, text, matchOpts);
  });
}

function queryByTitle() {
  for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
    args[_key3] = arguments[_key3];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [queryAllByTitle].concat(args));
}

function queryAllBySelectText(container, text) {
  var _ref5 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref5$exact = _ref5.exact,
      exact = _ref5$exact === undefined ? true : _ref5$exact,
      _ref5$collapseWhitesp = _ref5.collapseWhitespace,
      collapseWhitespace = _ref5$collapseWhitesp === undefined ? true : _ref5$collapseWhitesp,
      _ref5$trim = _ref5.trim,
      trim = _ref5$trim === undefined ? true : _ref5$trim;

  var matcher = exact ? _matches.matches : _matches.fuzzyMatches;
  var matchOpts = { collapseWhitespace, trim };
  return Array.from(container.querySelectorAll('select')).filter(function (selectNode) {
    var selectedOptions = Array.from(selectNode.options).filter(function (option) {
      return option.selected;
    });
    return selectedOptions.some(function (optionNode) {
      return matcher((0, _getNodeText.getNodeText)(optionNode), optionNode, text, matchOpts);
    });
  });
}

function queryBySelectText() {
  for (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
    args[_key4] = arguments[_key4];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [queryAllBySelectText].concat(args));
}

var queryByPlaceholderText = _queryHelpers.queryByAttribute.bind(null, 'placeholder');
var queryAllByPlaceholderText = _queryHelpers.queryAllByAttribute.bind(null, 'placeholder');
var queryByTestId = _queryHelpers.queryByAttribute.bind(null, 'data-testid');
var queryAllByTestId = _queryHelpers.queryAllByAttribute.bind(null, 'data-testid');
var queryByValue = _queryHelpers.queryByAttribute.bind(null, 'value');
var queryAllByValue = _queryHelpers.queryAllByAttribute.bind(null, 'value');
var queryByRole = _queryHelpers.queryByAttribute.bind(null, 'role');
var queryAllByRole = _queryHelpers.queryAllByAttribute.bind(null, 'role');

function queryAllByAltText(container, alt) {
  var _ref6 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref6$exact = _ref6.exact,
      exact = _ref6$exact === undefined ? true : _ref6$exact,
      _ref6$collapseWhitesp = _ref6.collapseWhitespace,
      collapseWhitespace = _ref6$collapseWhitesp === undefined ? true : _ref6$collapseWhitesp,
      _ref6$trim = _ref6.trim,
      trim = _ref6$trim === undefined ? true : _ref6$trim;

  var matcher = exact ? _matches.matches : _matches.fuzzyMatches;
  var matchOpts = { collapseWhitespace, trim };
  return Array.from(container.querySelectorAll('img,input,area')).filter(function (node) {
    return matcher(node.getAttribute('alt'), node, alt, matchOpts);
  });
}

function queryByAltText() {
  for (var _len5 = arguments.length, args = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {
    args[_key5] = arguments[_key5];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [queryAllByAltText].concat(args));
}

// getters
// the reason we're not dynamically generating these functions that look so similar:
// 1. The error messages are specific to each one and depend on arguments
// 2. The stack trace will look better because it'll have a helpful method name.

function getAllByTestId(container, id) {
  for (var _len6 = arguments.length, rest = Array(_len6 > 2 ? _len6 - 2 : 0), _key6 = 2; _key6 < _len6; _key6++) {
    rest[_key6 - 2] = arguments[_key6];
  }

  var els = queryAllByTestId.apply(undefined, [container, id].concat(rest));
  if (!els.length) {
    throw (0, _queryHelpers.getElementError)(`Unable to find an element by: [data-testid="${id}"]`, container);
  }
  return els;
}

function getByTestId() {
  for (var _len7 = arguments.length, args = Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {
    args[_key7] = arguments[_key7];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [getAllByTestId].concat(args));
}

function getAllByTitle(container, title) {
  for (var _len8 = arguments.length, rest = Array(_len8 > 2 ? _len8 - 2 : 0), _key8 = 2; _key8 < _len8; _key8++) {
    rest[_key8 - 2] = arguments[_key8];
  }

  var els = queryAllByTitle.apply(undefined, [container, title].concat(rest));
  if (!els.length) {
    throw (0, _queryHelpers.getElementError)(`Unable to find an element with the title: ${title}.`, container);
  }
  return els;
}

function getByTitle() {
  for (var _len9 = arguments.length, args = Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {
    args[_key9] = arguments[_key9];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [getAllByTitle].concat(args));
}

function getAllByValue(container, value) {
  for (var _len10 = arguments.length, rest = Array(_len10 > 2 ? _len10 - 2 : 0), _key10 = 2; _key10 < _len10; _key10++) {
    rest[_key10 - 2] = arguments[_key10];
  }

  var els = queryAllByValue.apply(undefined, [container, value].concat(rest));
  if (!els.length) {
    throw (0, _queryHelpers.getElementError)(`Unable to find an element with the value: ${value}.`, container);
  }
  return els;
}

function getByValue() {
  for (var _len11 = arguments.length, args = Array(_len11), _key11 = 0; _key11 < _len11; _key11++) {
    args[_key11] = arguments[_key11];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [getAllByValue].concat(args));
}

function getAllByPlaceholderText(container, text) {
  for (var _len12 = arguments.length, rest = Array(_len12 > 2 ? _len12 - 2 : 0), _key12 = 2; _key12 < _len12; _key12++) {
    rest[_key12 - 2] = arguments[_key12];
  }

  var els = queryAllByPlaceholderText.apply(undefined, [container, text].concat(rest));
  if (!els.length) {
    throw (0, _queryHelpers.getElementError)(`Unable to find an element with the placeholder text of: ${text}`, container);
  }
  return els;
}

function getByPlaceholderText() {
  for (var _len13 = arguments.length, args = Array(_len13), _key13 = 0; _key13 < _len13; _key13++) {
    args[_key13] = arguments[_key13];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [getAllByPlaceholderText].concat(args));
}

function getAllByLabelText(container, text) {
  for (var _len14 = arguments.length, rest = Array(_len14 > 2 ? _len14 - 2 : 0), _key14 = 2; _key14 < _len14; _key14++) {
    rest[_key14 - 2] = arguments[_key14];
  }

  var els = queryAllByLabelText.apply(undefined, [container, text].concat(rest));
  if (!els.length) {
    var labels = queryAllLabelsByText.apply(undefined, [container, text].concat(rest));
    if (labels.length) {
      throw (0, _queryHelpers.getElementError)(`Found a label with the text of: ${text}, however no form control was found associated to that label. Make sure you're using the "for" attribute or "aria-labelledby" attribute correctly.`, container);
    } else {
      throw (0, _queryHelpers.getElementError)(`Unable to find a label with the text of: ${text}`, container);
    }
  }
  return els;
}

function getByLabelText() {
  for (var _len15 = arguments.length, args = Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {
    args[_key15] = arguments[_key15];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [getAllByLabelText].concat(args));
}

function getAllByText(container, text) {
  for (var _len16 = arguments.length, rest = Array(_len16 > 2 ? _len16 - 2 : 0), _key16 = 2; _key16 < _len16; _key16++) {
    rest[_key16 - 2] = arguments[_key16];
  }

  var els = queryAllByText.apply(undefined, [container, text].concat(rest));
  if (!els.length) {
    throw (0, _queryHelpers.getElementError)(`Unable to find an element with the text: ${text}. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.`, container);
  }
  return els;
}

function getByText() {
  for (var _len17 = arguments.length, args = Array(_len17), _key17 = 0; _key17 < _len17; _key17++) {
    args[_key17] = arguments[_key17];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [getAllByText].concat(args));
}

function getAllByAltText(container, alt) {
  for (var _len18 = arguments.length, rest = Array(_len18 > 2 ? _len18 - 2 : 0), _key18 = 2; _key18 < _len18; _key18++) {
    rest[_key18 - 2] = arguments[_key18];
  }

  var els = queryAllByAltText.apply(undefined, [container, alt].concat(rest));
  if (!els.length) {
    throw (0, _queryHelpers.getElementError)(`Unable to find an element with the alt text: ${alt}`, container);
  }
  return els;
}

function getByAltText() {
  for (var _len19 = arguments.length, args = Array(_len19), _key19 = 0; _key19 < _len19; _key19++) {
    args[_key19] = arguments[_key19];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [getAllByAltText].concat(args));
}

function getAllByRole(container, id) {
  for (var _len20 = arguments.length, rest = Array(_len20 > 2 ? _len20 - 2 : 0), _key20 = 2; _key20 < _len20; _key20++) {
    rest[_key20 - 2] = arguments[_key20];
  }

  var els = queryAllByRole.apply(undefined, [container, id].concat(rest));
  if (!els.length) {
    throw (0, _queryHelpers.getElementError)(`Unable to find an element by role=${id}`, container);
  }
  return els;
}

function getByRole() {
  for (var _len21 = arguments.length, args = Array(_len21), _key21 = 0; _key21 < _len21; _key21++) {
    args[_key21] = arguments[_key21];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [getAllByRole].concat(args));
}

function getAllBySelectText(container, text) {
  for (var _len22 = arguments.length, rest = Array(_len22 > 2 ? _len22 - 2 : 0), _key22 = 2; _key22 < _len22; _key22++) {
    rest[_key22 - 2] = arguments[_key22];
  }

  var els = queryAllBySelectText.apply(undefined, [container, text].concat(rest));
  if (!els.length) {
    throw (0, _queryHelpers.getElementError)(`Unable to find a <select> element with the selected option's text: ${text}`, container);
  }
  return els;
}

function getBySelectText() {
  for (var _len23 = arguments.length, args = Array(_len23), _key23 = 0; _key23 < _len23; _key23++) {
    args[_key23] = arguments[_key23];
  }

  return _queryHelpers.firstResultOrNull.apply(undefined, [getAllBySelectText].concat(args));
}

exports.queryByPlaceholderText = queryByPlaceholderText;
exports.queryAllByPlaceholderText = queryAllByPlaceholderText;
exports.getByPlaceholderText = getByPlaceholderText;
exports.getAllByPlaceholderText = getAllByPlaceholderText;
exports.queryByText = queryByText;
exports.queryAllByText = queryAllByText;
exports.getByText = getByText;
exports.getAllByText = getAllByText;
exports.queryByLabelText = queryByLabelText;
exports.queryAllByLabelText = queryAllByLabelText;
exports.getByLabelText = getByLabelText;
exports.getAllByLabelText = getAllByLabelText;
exports.queryByAltText = queryByAltText;
exports.queryAllByAltText = queryAllByAltText;
exports.getByAltText = getByAltText;
exports.getAllByAltText = getAllByAltText;
exports.queryBySelectText = queryBySelectText;
exports.queryAllBySelectText = queryAllBySelectText;
exports.getBySelectText = getBySelectText;
exports.getAllBySelectText = getAllBySelectText;
exports.queryByTestId = queryByTestId;
exports.queryAllByTestId = queryAllByTestId;
exports.getByTestId = getByTestId;
exports.getAllByTestId = getAllByTestId;
exports.queryByTitle = queryByTitle;
exports.queryAllByTitle = queryAllByTitle;
exports.getByTitle = getByTitle;
exports.getAllByTitle = getAllByTitle;
exports.queryByValue = queryByValue;
exports.queryAllByValue = queryAllByValue;
exports.getByValue = getByValue;
exports.getAllByValue = getAllByValue;
exports.queryByRole = queryByRole;
exports.queryAllByRole = queryAllByRole;
exports.getAllByRole = getAllByRole;
exports.getByRole = getByRole;

/* eslint complexity:["error", 14] */